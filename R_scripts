#We use seurat 3.0 package to perform dimensional reduction
#Please check the seurat here https://satijalab.org/seurat/v3.0/pbmc3k_tutorial.html
#Created date, 08/06/2019
#
#
# Firstly, we identify the top HVGs each case,
#
#
gliomaPatient<-read.table('patient_gene_matrix',row.names=1,head=TRUE)
gliomaPatient<-CreateSeuratObject(counts = gliomaPatient, min.cells = 10, min.features = 200)#For the sample less than 200 cells, setting min.cells = 5, min.features = 200
gliomaPatient[["percent.mt"]] <- PercentageFeatureSet(gliomaPatient, pattern = "^MT-")
VlnPlot(gliomaPatient, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
gliomaPatient <- subset(gliomaPatient, subset = percent.mt < 5)
all.genes <- rownames(gliomaPatient)
gliomaPatient <- NormalizeData(gliomaPatient, normalization.method = "LogNormalize", scale.factor = 10000)
gliomaPatient <- FindVariableFeatures(gliomaPatient, selection.method = "vst", nfeatures = 1000)
#
#
# Then the PCA was done using those genes that were among the 1000 most variable genes for at least three patients
#
#
gliomaMergedP<-read.table('patients_gene_matrix',row.names=1,head=TRUE)
gliomaMergedP<-CreateSeuratObject(counts = gliomaMergedP)
gliomaMergedP[["percent.mt"]] <- PercentageFeatureSet(gliomaMergedP, pattern = "^MT-")
VlnPlot(gliomaMergedP, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
gliomaMergedP <- subset(gliomaMergedP, subset = percent.mt < 5)
gliomaMergedP <- NormalizeData(gliomaMergedP, normalization.method = "LogNormalize", scale.factor = 10000)
gliomaMergedP <- ScaleData(object = gliomaMergedP,vars.to.regress = c("percent.mt"))
gliomaMergedP <- RunPCA(gliomaMergedP, features = HVGs_selected.genes)
DimPlot(gliomaMergedP, reduction = "pca",dims = c(1, 2), label = T)
gliomaMergedP <- RunUMAP(gliomaMergedP, dims = 1:10, label = T)
gliomaMergedP <- RunTSNE(gliomaMergedP, dims = 1:10, label = T)


#
#

