#We use seurat 3.0 package to perform dimensional reduction
#Please check the seurat here https://satijalab.org/seurat/v3.0/pbmc3k_tutorial.html
#Created date, 08/06/2019
#
#
# Firstly, we identify the top HVGs each case,
#
#
gliomaPatient<-read.table('patient_gene_matrix',row.names=1,head=TRUE)
gliomaPatient<-CreateSeuratObject(counts = gliomaPatient, min.cells = 10, min.features = 200)#For the sample less than 200 cells, setting min.cells = 5, min.features = 200
gliomaPatient[["percent.mt"]] <- PercentageFeatureSet(gliomaPatient, pattern = "^MT-")
VlnPlot(gliomaPatient, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
gliomaPatient <- subset(gliomaPatient, subset = percent.mt < 5)
all.genes <- rownames(gliomaPatient)
gliomaPatient <- NormalizeData(gliomaPatient, normalization.method = "LogNormalize", scale.factor = 10000)
gliomaPatient <- FindVariableFeatures(gliomaPatient, selection.method = "vst", nfeatures = 1000)
#
#
# Then the PCA was done using those genes that were among the 1000 most variable genes for at least three patients
#
#
gliomaMP<-read.table('patients_gene_matrix',row.names=1,head=TRUE)
gliomaMP<-CreateSeuratObject(counts = gliomaMP)
gliomaMP[["percent.mt"]] <- PercentageFeatureSet(gliomaMP, pattern = "^MT-")
VlnPlot(gliomaMP, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
gliomaMP <- subset(gliomaMP, subset = percent.mt < 5)
gliomaMP <- NormalizeData(gliomaMP, normalization.method = "LogNormalize", scale.factor = 10000)
gliomaMP <- ScaleData(object = gliomaMP,vars.to.regress = c("percent.mt"))
gliomaMP <- RunPCA(gliomaMP, features = HVGs.genes)
DimPlot(gliomaMP, reduction = "pca",dims = c(1, 2), label = T)
gliomaMP <- RunUMAP(gliomaMP, dims = 1:10, label = T)
gliomaMP <- RunTSNE(gliomaMP, dims = 1:10, label = T)


#
#

